{"dependencies":[{"name":"./wrap-idb-value.cjs","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":19,"index":98},"end":{"line":5,"column":50,"index":129}}],"key":"bJvH+b+nMCfa1L2b0vvAC8evhEw=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  var wrapIdbValue = require(_dependencyMap[0], \"./wrap-idb-value.cjs\");\n\n  /**\n   * Open a database.\n   *\n   * @param name Name of the database.\n   * @param version Schema version.\n   * @param callbacks Additional callbacks.\n   */\n  function openDB(name, version, {\n    blocked,\n    upgrade,\n    blocking,\n    terminated\n  } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrapIdbValue.wrap(request);\n    if (upgrade) {\n      request.addEventListener('upgradeneeded', event => {\n        upgrade(wrapIdbValue.wrap(request.result), event.oldVersion, event.newVersion, wrapIdbValue.wrap(request.transaction), event);\n      });\n    }\n    if (blocked) {\n      request.addEventListener('blocked', event => blocked(\n      // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n      event.oldVersion, event.newVersion, event));\n    }\n    openPromise.then(db => {\n      if (terminated) db.addEventListener('close', () => terminated());\n      if (blocking) {\n        db.addEventListener('versionchange', event => blocking(event.oldVersion, event.newVersion, event));\n      }\n    }).catch(() => {});\n    return openPromise;\n  }\n  /**\n   * Delete a database.\n   *\n   * @param name Name of the database.\n   */\n  function deleteDB(name, {\n    blocked\n  } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n      request.addEventListener('blocked', event => blocked(\n      // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n      event.oldVersion, event));\n    }\n    return wrapIdbValue.wrap(request).then(() => undefined);\n  }\n  const readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\n  const writeMethods = ['put', 'add', 'delete', 'clear'];\n  const cachedMethods = new Map();\n  function getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase && !(prop in target) && typeof prop === 'string')) {\n      return;\n    }\n    if (cachedMethods.get(prop)) return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) || !(isWrite || readMethods.includes(targetFuncName))) {\n      return;\n    }\n    const method = async function (storeName, ...args) {\n      // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n      const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n      let target = tx.store;\n      if (useIndex) target = target.index(args.shift());\n      // Must reject if op rejects.\n      // If it's a write operation, must reject if tx.done rejects.\n      // Must reject with op rejection first.\n      // Must resolve with op value.\n      // Must handle both promises (no unhandled rejections)\n      return (await Promise.all([target[targetFuncName](...args), isWrite && tx.done]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n  }\n  wrapIdbValue.replaceTraps(oldTraps => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop)\n  }));\n  exports.unwrap = wrapIdbValue.unwrap;\n  exports.wrap = wrapIdbValue.wrap;\n  exports.deleteDB = deleteDB;\n  exports.openDB = openDB;\n});","lineCount":98,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0,"Object"],[4,8,3,6],[4,9,3,7,"defineProperty"],[4,23,3,21],[4,24,3,22,"exports"],[4,31,3,29],[4,33,3,31],[4,45,3,43],[4,47,3,45],[5,4,3,47,"value"],[5,9,3,52],[5,11,3,54],[6,2,3,59],[6,3,3,60],[6,4,3,61],[7,2,5,0],[7,6,5,4,"wrapIdbValue"],[7,18,5,16],[7,21,5,19,"require"],[7,28,5,26],[7,29,5,26,"_dependencyMap"],[7,43,5,26],[7,70,5,49],[7,71,5,50],[9,2,7,0],[10,0,8,0],[11,0,9,0],[12,0,10,0],[13,0,11,0],[14,0,12,0],[15,0,13,0],[16,2,14,0],[16,11,14,9,"openDB"],[16,17,14,15,"openDB"],[16,18,14,16,"name"],[16,22,14,20],[16,24,14,22,"version"],[16,31,14,29],[16,33,14,31],[17,4,14,33,"blocked"],[17,11,14,40],[18,4,14,42,"upgrade"],[18,11,14,49],[19,4,14,51,"blocking"],[19,12,14,59],[20,4,14,61,"terminated"],[21,2,14,72],[21,3,14,73],[21,6,14,76],[21,7,14,77],[21,8,14,78],[21,10,14,80],[22,4,15,4],[22,10,15,10,"request"],[22,17,15,17],[22,20,15,20,"indexedDB"],[22,29,15,29],[22,30,15,30,"open"],[22,34,15,34],[22,35,15,35,"name"],[22,39,15,39],[22,41,15,41,"version"],[22,48,15,48],[22,49,15,49],[23,4,16,4],[23,10,16,10,"openPromise"],[23,21,16,21],[23,24,16,24,"wrapIdbValue"],[23,36,16,36],[23,37,16,37,"wrap"],[23,41,16,41],[23,42,16,42,"request"],[23,49,16,49],[23,50,16,50],[24,4,17,4],[24,8,17,8,"upgrade"],[24,15,17,15],[24,17,17,17],[25,6,18,8,"request"],[25,13,18,15],[25,14,18,16,"addEventListener"],[25,30,18,32],[25,31,18,33],[25,46,18,48],[25,48,18,51,"event"],[25,53,18,56],[25,57,18,61],[26,8,19,12,"upgrade"],[26,15,19,19],[26,16,19,20,"wrapIdbValue"],[26,28,19,32],[26,29,19,33,"wrap"],[26,33,19,37],[26,34,19,38,"request"],[26,41,19,45],[26,42,19,46,"result"],[26,48,19,52],[26,49,19,53],[26,51,19,55,"event"],[26,56,19,60],[26,57,19,61,"oldVersion"],[26,67,19,71],[26,69,19,73,"event"],[26,74,19,78],[26,75,19,79,"newVersion"],[26,85,19,89],[26,87,19,91,"wrapIdbValue"],[26,99,19,103],[26,100,19,104,"wrap"],[26,104,19,108],[26,105,19,109,"request"],[26,112,19,116],[26,113,19,117,"transaction"],[26,124,19,128],[26,125,19,129],[26,127,19,131,"event"],[26,132,19,136],[26,133,19,137],[27,6,20,8],[27,7,20,9],[27,8,20,10],[28,4,21,4],[29,4,22,4],[29,8,22,8,"blocked"],[29,15,22,15],[29,17,22,17],[30,6,23,8,"request"],[30,13,23,15],[30,14,23,16,"addEventListener"],[30,30,23,32],[30,31,23,33],[30,40,23,42],[30,42,23,45,"event"],[30,47,23,50],[30,51,23,55,"blocked"],[30,58,23,62],[31,6,24,8],[32,6,25,8,"event"],[32,11,25,13],[32,12,25,14,"oldVersion"],[32,22,25,24],[32,24,25,26,"event"],[32,29,25,31],[32,30,25,32,"newVersion"],[32,40,25,42],[32,42,25,44,"event"],[32,47,25,49],[32,48,25,50],[32,49,25,51],[33,4,26,4],[34,4,27,4,"openPromise"],[34,15,27,15],[34,16,28,9,"then"],[34,20,28,13],[34,21,28,15,"db"],[34,23,28,17],[34,27,28,22],[35,6,29,8],[35,10,29,12,"terminated"],[35,20,29,22],[35,22,30,12,"db"],[35,24,30,14],[35,25,30,15,"addEventListener"],[35,41,30,31],[35,42,30,32],[35,49,30,39],[35,51,30,41],[35,57,30,47,"terminated"],[35,67,30,57],[35,68,30,58],[35,69,30,59],[35,70,30,60],[36,6,31,8],[36,10,31,12,"blocking"],[36,18,31,20],[36,20,31,22],[37,8,32,12,"db"],[37,10,32,14],[37,11,32,15,"addEventListener"],[37,27,32,31],[37,28,32,32],[37,43,32,47],[37,45,32,50,"event"],[37,50,32,55],[37,54,32,60,"blocking"],[37,62,32,68],[37,63,32,69,"event"],[37,68,32,74],[37,69,32,75,"oldVersion"],[37,79,32,85],[37,81,32,87,"event"],[37,86,32,92],[37,87,32,93,"newVersion"],[37,97,32,103],[37,99,32,105,"event"],[37,104,32,110],[37,105,32,111],[37,106,32,112],[38,6,33,8],[39,4,34,4],[39,5,34,5],[39,6,34,6],[39,7,35,9,"catch"],[39,12,35,14],[39,13,35,15],[39,19,35,21],[39,20,35,23],[39,21,35,24],[39,22,35,25],[40,4,36,4],[40,11,36,11,"openPromise"],[40,22,36,22],[41,2,37,0],[42,2,38,0],[43,0,39,0],[44,0,40,0],[45,0,41,0],[46,0,42,0],[47,2,43,0],[47,11,43,9,"deleteDB"],[47,19,43,17,"deleteDB"],[47,20,43,18,"name"],[47,24,43,22],[47,26,43,24],[48,4,43,26,"blocked"],[49,2,43,34],[49,3,43,35],[49,6,43,38],[49,7,43,39],[49,8,43,40],[49,10,43,42],[50,4,44,4],[50,10,44,10,"request"],[50,17,44,17],[50,20,44,20,"indexedDB"],[50,29,44,29],[50,30,44,30,"deleteDatabase"],[50,44,44,44],[50,45,44,45,"name"],[50,49,44,49],[50,50,44,50],[51,4,45,4],[51,8,45,8,"blocked"],[51,15,45,15],[51,17,45,17],[52,6,46,8,"request"],[52,13,46,15],[52,14,46,16,"addEventListener"],[52,30,46,32],[52,31,46,33],[52,40,46,42],[52,42,46,45,"event"],[52,47,46,50],[52,51,46,55,"blocked"],[52,58,46,62],[53,6,47,8],[54,6,48,8,"event"],[54,11,48,13],[54,12,48,14,"oldVersion"],[54,22,48,24],[54,24,48,26,"event"],[54,29,48,31],[54,30,48,32],[54,31,48,33],[55,4,49,4],[56,4,50,4],[56,11,50,11,"wrapIdbValue"],[56,23,50,23],[56,24,50,24,"wrap"],[56,28,50,28],[56,29,50,29,"request"],[56,36,50,36],[56,37,50,37],[56,38,50,38,"then"],[56,42,50,42],[56,43,50,43],[56,49,50,49,"undefined"],[56,58,50,58],[56,59,50,59],[57,2,51,0],[58,2,53,0],[58,8,53,6,"readMethods"],[58,19,53,17],[58,22,53,20],[58,23,53,21],[58,28,53,26],[58,30,53,28],[58,38,53,36],[58,40,53,38],[58,48,53,46],[58,50,53,48],[58,62,53,60],[58,64,53,62],[58,71,53,69],[58,72,53,70],[59,2,54,0],[59,8,54,6,"writeMethods"],[59,20,54,18],[59,23,54,21],[59,24,54,22],[59,29,54,27],[59,31,54,29],[59,36,54,34],[59,38,54,36],[59,46,54,44],[59,48,54,46],[59,55,54,53],[59,56,54,54],[60,2,55,0],[60,8,55,6,"cachedMethods"],[60,21,55,19],[60,24,55,22],[60,28,55,26,"Map"],[60,31,55,29],[60,32,55,30],[60,33,55,31],[61,2,56,0],[61,11,56,9,"getMethod"],[61,20,56,18,"getMethod"],[61,21,56,19,"target"],[61,27,56,25],[61,29,56,27,"prop"],[61,33,56,31],[61,35,56,33],[62,4,57,4],[62,8,57,8],[62,10,57,10,"target"],[62,16,57,16],[62,28,57,28,"IDBDatabase"],[62,39,57,39],[62,43,58,8],[62,45,58,10,"prop"],[62,49,58,14],[62,53,58,18,"target"],[62,59,58,24],[62,60,58,25],[62,64,59,8],[62,71,59,15,"prop"],[62,75,59,19],[62,80,59,24],[62,88,59,32],[62,89,59,33],[62,91,59,35],[63,6,60,8],[64,4,61,4],[65,4,62,4],[65,8,62,8,"cachedMethods"],[65,21,62,21],[65,22,62,22,"get"],[65,25,62,25],[65,26,62,26,"prop"],[65,30,62,30],[65,31,62,31],[65,33,63,8],[65,40,63,15,"cachedMethods"],[65,53,63,28],[65,54,63,29,"get"],[65,57,63,32],[65,58,63,33,"prop"],[65,62,63,37],[65,63,63,38],[66,4,64,4],[66,10,64,10,"targetFuncName"],[66,24,64,24],[66,27,64,27,"prop"],[66,31,64,31],[66,32,64,32,"replace"],[66,39,64,39],[66,40,64,40],[66,52,64,52],[66,54,64,54],[66,56,64,56],[66,57,64,57],[67,4,65,4],[67,10,65,10,"useIndex"],[67,18,65,18],[67,21,65,21,"prop"],[67,25,65,25],[67,30,65,30,"targetFuncName"],[67,44,65,44],[68,4,66,4],[68,10,66,10,"isWrite"],[68,17,66,17],[68,20,66,20,"writeMethods"],[68,32,66,32],[68,33,66,33,"includes"],[68,41,66,41],[68,42,66,42,"targetFuncName"],[68,56,66,56],[68,57,66,57],[69,4,67,4],[70,4,68,4],[71,4,69,4],[71,6,69,6,"targetFuncName"],[71,20,69,20],[71,24,69,24],[71,25,69,25,"useIndex"],[71,33,69,33],[71,36,69,36,"IDBIndex"],[71,44,69,44],[71,47,69,47,"IDBObjectStore"],[71,61,69,61],[71,63,69,63,"prototype"],[71,72,69,72],[71,73,69,73],[71,77,70,8],[71,79,70,10,"isWrite"],[71,86,70,17],[71,90,70,21,"readMethods"],[71,101,70,32],[71,102,70,33,"includes"],[71,110,70,41],[71,111,70,42,"targetFuncName"],[71,125,70,56],[71,126,70,57],[71,127,70,58],[71,129,70,60],[72,6,71,8],[73,4,72,4],[74,4,73,4],[74,10,73,10,"method"],[74,16,73,16],[74,19,73,19],[74,34,73,19,"method"],[74,35,73,35,"storeName"],[74,44,73,44],[74,46,73,46],[74,49,73,49,"args"],[74,53,73,53],[74,55,73,55],[75,6,74,8],[76,6,75,8],[76,12,75,14,"tx"],[76,14,75,16],[76,17,75,19],[76,21,75,23],[76,22,75,24,"transaction"],[76,33,75,35],[76,34,75,36,"storeName"],[76,43,75,45],[76,45,75,47,"isWrite"],[76,52,75,54],[76,55,75,57],[76,66,75,68],[76,69,75,71],[76,79,75,81],[76,80,75,82],[77,6,76,8],[77,10,76,12,"target"],[77,16,76,18],[77,19,76,21,"tx"],[77,21,76,23],[77,22,76,24,"store"],[77,27,76,29],[78,6,77,8],[78,10,77,12,"useIndex"],[78,18,77,20],[78,20,78,12,"target"],[78,26,78,18],[78,29,78,21,"target"],[78,35,78,27],[78,36,78,28,"index"],[78,41,78,33],[78,42,78,34,"args"],[78,46,78,38],[78,47,78,39,"shift"],[78,52,78,44],[78,53,78,45],[78,54,78,46],[78,55,78,47],[79,6,79,8],[80,6,80,8],[81,6,81,8],[82,6,82,8],[83,6,83,8],[84,6,84,8],[84,13,84,15],[84,14,84,16],[84,20,84,22,"Promise"],[84,27,84,29],[84,28,84,30,"all"],[84,31,84,33],[84,32,84,34],[84,33,85,12,"target"],[84,39,85,18],[84,40,85,19,"targetFuncName"],[84,54,85,33],[84,55,85,34],[84,56,85,35],[84,59,85,38,"args"],[84,63,85,42],[84,64,85,43],[84,66,86,12,"isWrite"],[84,73,86,19],[84,77,86,23,"tx"],[84,79,86,25],[84,80,86,26,"done"],[84,84,86,30],[84,85,87,9],[84,86,87,10],[84,88,87,12],[84,89,87,13],[84,90,87,14],[85,4,88,4],[85,5,88,5],[86,4,89,4,"cachedMethods"],[86,17,89,17],[86,18,89,18,"set"],[86,21,89,21],[86,22,89,22,"prop"],[86,26,89,26],[86,28,89,28,"method"],[86,34,89,34],[86,35,89,35],[87,4,90,4],[87,11,90,11,"method"],[87,17,90,17],[88,2,91,0],[89,2,92,0,"wrapIdbValue"],[89,14,92,12],[89,15,92,13,"replaceTraps"],[89,27,92,25],[89,28,92,27,"oldTraps"],[89,36,92,35],[89,41,92,41],[90,4,93,4],[90,7,93,7,"oldTraps"],[90,15,93,15],[91,4,94,4,"get"],[91,7,94,7],[91,9,94,9,"get"],[91,10,94,10,"target"],[91,16,94,16],[91,18,94,18,"prop"],[91,22,94,22],[91,24,94,24,"receiver"],[91,32,94,32],[91,37,94,37,"getMethod"],[91,46,94,46],[91,47,94,47,"target"],[91,53,94,53],[91,55,94,55,"prop"],[91,59,94,59],[91,60,94,60],[91,64,94,64,"oldTraps"],[91,72,94,72],[91,73,94,73,"get"],[91,76,94,76],[91,77,94,77,"target"],[91,83,94,83],[91,85,94,85,"prop"],[91,89,94,89],[91,91,94,91,"receiver"],[91,99,94,99],[91,100,94,100],[92,4,95,4,"has"],[92,7,95,7],[92,9,95,9,"has"],[92,10,95,10,"target"],[92,16,95,16],[92,18,95,18,"prop"],[92,22,95,22],[92,27,95,27],[92,28,95,28],[92,29,95,29,"getMethod"],[92,38,95,38],[92,39,95,39,"target"],[92,45,95,45],[92,47,95,47,"prop"],[92,51,95,51],[92,52,95,52],[92,56,95,56,"oldTraps"],[92,64,95,64],[92,65,95,65,"has"],[92,68,95,68],[92,69,95,69,"target"],[92,75,95,75],[92,77,95,77,"prop"],[92,81,95,81],[93,2,96,0],[93,3,96,1],[93,4,96,2],[93,5,96,3],[94,2,98,0,"exports"],[94,9,98,7],[94,10,98,8,"unwrap"],[94,16,98,14],[94,19,98,17,"wrapIdbValue"],[94,31,98,29],[94,32,98,30,"unwrap"],[94,38,98,36],[95,2,99,0,"exports"],[95,9,99,7],[95,10,99,8,"wrap"],[95,14,99,12],[95,17,99,15,"wrapIdbValue"],[95,29,99,27],[95,30,99,28,"wrap"],[95,34,99,32],[96,2,100,0,"exports"],[96,9,100,7],[96,10,100,8,"deleteDB"],[96,18,100,16],[96,21,100,19,"deleteDB"],[96,29,100,27],[97,2,101,0,"exports"],[97,9,101,7],[97,10,101,8,"openDB"],[97,16,101,14],[97,19,101,17,"openDB"],[97,25,101,23],[98,0,101,24],[98,3]],"functionMap":{"names":["<global>","openDB","request.addEventListener$argument_1","openPromise.then$argument_0","db.addEventListener$argument_1","openPromise.then._catch$argument_0","deleteDB","wrapIdbValue.wrap.then$argument_0","getMethod","method","wrapIdbValue.replaceTraps$argument_0","get","has"],"mappings":"AAA;ACa;kDCI;SDE;4CCG;kDDE;cEG;yCCE,kBD;iDCE,8DD;KFE;eIC,SJ;CDE;AMM;4CJG;gCIE;2CCE,eD;CNC;AQK;mBCiB;KDe;CRG;0BUC;SCE,2FD;SEC,yEF;EVC"},"hasCjsExports":true},"type":"js/module"}]}